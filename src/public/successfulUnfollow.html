<!doctype html>
<html>
  <head>
    <title>Artists' Saved Songs</title>
    <link rel="icon" href="./assets/icons/Spotify_Icon_RGB_Green.png">
    <link href="./styles/css/styles.css" rel="stylesheet" type="text/css"/>
  </head>

  <body>
    <div class="myContainer">
      <div class="navBar">
        <h1><a href="/" class="titleLink">Artists Saved Songs Playlists</a></h1>
        <img src="./assets/logos/Spotify_Logo_RGB_White.png" id="navBarLogo"/>
      </div>
      <div id="content">
        <div id="unfollowed">
          <h1>The unfollow process has finished!</h1>
          <h2>If you subscribed, please type your email and click "Unsubscribe"</h2>
          <div id="emailGroup" class="input-group input-group-lg">
            <div class="input-group-prepend">
                <span class="input-group-text" id="emailDesc">Email</span>
            </div>
            <input id="email" type="text" class="form-control" aria-label="email textbox" aria-describedby="emailDesc">
          </div>
          <button onclick="unsubscribe()" id="unsubscribe-btn" class="btn btn-success btn-lg">Unsubscribe</button>

          <a href="" id="return-btn" class="btn btn-success btn-lg">Return to the main page</a>
        </div>
      </div>

      <footer class="px-4 flex flex-col items-center gap-4 py-5 text-center">
        <p
          class="underline underline-offset-4 max-w-[50ch] mb-10"
          title="This site uses Google Analytics (which adds cookies) to measure the number of users and the countries they are from. I don’t store any of your private identifiable information."
          >This site uses Google Analytics (which adds cookies) to measure the number
          of unique visitors.</p
        >
        <p>© 2022 Henry Faulkner. All rights reserved.</p>
      </footer>
    </div>

    <script>
      const queryParams = getHashParams();
      // PLEASE CHANGE TO fetch onclick
      //document.getElementById("return-btn").href = `#access_token=${queryParams["access_token"]}&spotify_user_id=${queryParams["spotify_user_id"]}`;
      document.getElementById("return-btn").href = `/main.html#access_token=${queryParams["access_token"]}&refresh_token=${queryParams["refresh_token"]}&spotify_user_id=${queryParams["spotify_user_id"]}`;

      function unsubscribe() {
        window.location.href = `https://api-qdsvmmfcoq-ue.a.run.app/unsubscribe?email=${document.getElementById("email").value}`
      }

      /**
       * Obtains parameters from the hash of the URL
       * @return Object
       */
      function getHashParams() {
        var hashParams = {};
        var e, r = /([^&;=]+)=?([^&;]*)/g,
            q = window.location.hash.substring(1);
        while ( e = r.exec(q)) {
            hashParams[e[1]] = decodeURIComponent(e[2]);
        }
        return hashParams;
      }
    </script>
  </body>
</html>